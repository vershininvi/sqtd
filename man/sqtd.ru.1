.TH sqtd "1" "09.09.2013" "sqtd" "Пользовательские команды"
.SH ИМЯ
sqtd \- Squid traffic quotation daemon 
.SH СИНТАКСИС
sqtd [-c файл] [-n] [-v] [-h]
.SH ОПИСАНИЕ
.B sqtd
предназначен для ограничения интернет траффика пользователя на основе квот, установленных в файле конфигурации программы. Для запуска демона необходимо указать расположение конфигурационного файла (параметр -с командной строки, по умолчанию /etc/sqtd ). Анализ файла лога доступа squid.log  производится периодически, с интервалом указанным в параметре конфигурационного файла CheckInterval (в секундах).Резултаты работы протоколируются в файле лога, указанном в параметре конфигурационного файла LogFile, либо в системном логе если файл не указан, либо на стандартный вывод, если при запуске был указан параметр командной строки -n . Идентификатор процесса записывается в файл, указанный в параметре PidFile файла конфигурации. Результат работы может быть доступен через файл сокета, указанный в параметре конфигурационного файла SocksFile. Для обращения к файлу сокета используется программа - клиент sqtc (man sqtc), которая может быть запущена в интерактивном режиме, либо исползована для организации внешних списков доступа в файле конфигурации squid. 
.SH КЛЮЧИ
.TP
\fB\-c файл\fR  
использовать файл конфигурации
\fB\-h\fR
вывод краткой справки
.TP
\fB\-v\fR
вывод версии программы
.TP
\fB\-n\fR
запуск в отладочном  режиме с выводом отладочных сообщений в консоль
.SH ВОЗВРАЩАЕМЫЕ ЗНАЧЕНИЯ
.TP
0 \- нормальное завершение работы
.TP
1 \- небольшие проблемы
.TP
2 \- серьёзная проблема
.SH ФАЙЛЫ
.I /etc/sqtd/sqtd.conf 
.RS
файл конфигурации 
.RE
.I /var/lib/sqtd/sqtd.pid
.RS
файл идентификатора процесса, используется для идентификации процесса sqtd  
.RE
.I /var/lib/sqtd/sqtd.sock
.RS
файл сокета, используется для обмена данными с программой-клиентом sqtc 
.RE

.SH ФАЙЛЫ КОНФИГУРАЦИ
Путь к файлу конфигурации указывается через параметр командной строки -c. Программа обрабатывает файл конфигурации последовательно от начала до конца. Пустые строки игнорируются. Каждая непустая строка файла конфигурации представляет собой пару КЛЮЧ ЗНАЧЕНИЕ. Если ЗНАЧЕНИЕ представляет собой путь к файлу - рекомендуется указывать полный путь. По умолчанию /etc/sqtd/sqtd.conf.  

.RE
\fBПараметры файла конфигурации:\fR
.TP
\fBCheckInterval число\fR  
количество секунд между процедурами проверок (рекомендуемое значение для отладки - 5, 300 - для рабочего режима). По умолчанию 300 (5 минут) 
.RE
.TP
\fBAccessLogFile файл\fR 
путь к файлу лога squid access.log. По умолчанию /var/log/squid/access.log
.RE
.TP
\fBLogFile файл\fR       
путь к файлу лога (по умолачнию - системный лог в режиме демона и стандартный вывод в режиме отладки (параметр командно строки-n))
.RE
.TP
\fBPidFile файл\fR 
путь к файлу идентификатора процесса  (/var/lib/sqtd/sqtd.pid)
.RE
.TP
\fBSosckFile файл\fR 
путь к файлу сокета  (/var/lib/sqtd/sqtd.sock)
.RE
.TP
\fBSosckUser username\fR 
Владелец файла сокета 
.RE
.TP
\fBSosckUser groupname\fR 
Группа файла сокета 
.RE
.TP
\fBSoskMod mode\fR 
Режим доступа к файлу сокета (660) 
.RE

.TP
\fBSystemDomainDelimiter\fR 
 Разделитель имени домена и пользователя, используемый в системе. Может быть получен командой getent passwd 
.RE

.TP
\fBSquidDomainDelimiter\fR 
Разделитель имени домена и пользователя, который используется  в файле лога доступа squid (access.log)
.RE

.TP
\fBLimit ограничение\fR
Ограничения для пользователей указываются ключевым словом Limit. В качестве значения для ключевого слова Limit используется строка ограничения вида ТИП:ИМЯ:ПЕРИОД:КОЛИЧЕСТВО. Ограничение может быть двух типов - пользовательское  (u) или групповое (g). ИМЯ определяет имя пользователя или группы, на которое распространяется действие данного ограничения. ПЕРИОД - определяет срок действия ограничения и может быть представлен одним из трех значений h (час), d(день) или m (месяц). КОЛИЧЕСТВО указывает объем разрешенного траффика в байтах, килобайтах (K), мегабайтах (M) или гигабайтах (G). Если в качестве КОЛИЧЕСТВА указан 0, то для пользователя или группы  ограничения не используются. Поскольку файл конфигурации обрабатывается последовательно от начала и до конца, на пользователя или группу будет воздействовать самое последнее применимое к нему ограничение на соответсвующий период. Программа получает информацию о пользователях и группах при помощи стандартной системной функции getgrent(). ИМЯ, используемое  должно соответсвовать выводу getent passwd и getent group. При использовании прокси серывера совместно с MS AD для получения информации о пользователях и группах из AD необходимо  настроить samba в соответсвии с инструкциями подключения samba к MS AD.
.RE
.SH АВТОРЫ
Программа разработана Вершининым Владимиром Ивановичем 
<vershininvi@rambler.ru>. Россия. Волгоград.
.SH "СМОТРИТЕ ТАКЖЕ"
man getent, man smb.conf, man squid, man sqtc.
